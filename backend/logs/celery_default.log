 
 -------------- worker_default@fedora v5.4.0 (opalescent)
--- ***** ----- 
-- ******* ---- Linux-6.16.7-200.fc42.x86_64-x86_64-with-glibc2.41 2026-01-06 15:26:01
- *** --- * --- 
- ** ---------- [config]
- ** ---------- .> app:         poder_judicial:0x7ff0e591bfe0
- ** ---------- .> transport:   redis://localhost:6379/0
- ** ---------- .> results:     
- *** --- * --- .> concurrency: 1 (prefork)
-- ******* ---- .> task events: OFF (enable -E to monitor tasks in this worker)
--- ***** ----- 
 -------------- [queues]
                .> default          exchange=default(direct) key=default
                

[tasks]
  . apps.documents.tasks.compute_bertopic_model
  . apps.documents.tasks.compute_cluster_graph
  . apps.documents.tasks.process_document_analysis
  . apps.documents.tasks.process_document_upload
  . config.celery.debug_task

[2026-01-06 15:26:01,171: WARNING/MainProcess] /home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/celery/worker/consumer/consumer.py:508: CPendingDeprecationWarning: The broker_connection_retry configuration setting will no longer determine
whether broker connection retries are made during startup in Celery 6.0 and above.
If you wish to retain the existing behavior for retrying connections on startup,
you should set broker_connection_retry_on_startup to True.
  warnings.warn(

[2026-01-06 15:26:01,176: INFO/MainProcess] Connected to redis://localhost:6379/0
[2026-01-06 15:26:01,177: WARNING/MainProcess] /home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/celery/worker/consumer/consumer.py:508: CPendingDeprecationWarning: The broker_connection_retry configuration setting will no longer determine
whether broker connection retries are made during startup in Celery 6.0 and above.
If you wish to retain the existing behavior for retrying connections on startup,
you should set broker_connection_retry_on_startup to True.
  warnings.warn(

[2026-01-06 15:26:01,179: INFO/MainProcess] mingle: searching for neighbors
[2026-01-06 15:26:02,186: INFO/MainProcess] mingle: all alone
[2026-01-06 15:26:02,201: INFO/MainProcess] worker_default@fedora ready.
[2026-01-06 15:26:53,306: INFO/MainProcess] Task apps.documents.tasks.compute_bertopic_model[24142269-a1dc-4f2c-8527-47d88f6c69c5] received
[2026-01-06 15:26:57,697: INFO/ForkPoolWorker-1] ================================================================================
[2026-01-06 15:26:57,697: INFO/ForkPoolWorker-1] üéØ STARTING BERTOPIC MODEL COMPUTATION
[2026-01-06 15:26:57,697: INFO/ForkPoolWorker-1] ================================================================================
[2026-01-06 15:26:57,697: INFO/ForkPoolWorker-1] Parameters:
[2026-01-06 15:26:57,697: INFO/ForkPoolWorker-1]   - max_documents: 1000
[2026-01-06 15:26:57,697: INFO/ForkPoolWorker-1]   - min_topic_size: 5
[2026-01-06 15:26:57,697: INFO/ForkPoolWorker-1]   - nr_topics: auto
[2026-01-06 15:26:57,697: INFO/ForkPoolWorker-1]   - embedding_field: clean_embedding
[2026-01-06 15:26:57,701: INFO/ForkPoolWorker-1] ================================================================================
[2026-01-06 15:26:57,701: INFO/ForkPoolWorker-1] üöÄ Starting OPTIMIZED BERTopic computation...
[2026-01-06 15:26:57,701: INFO/ForkPoolWorker-1] ================================================================================
[2026-01-06 15:26:57,701: INFO/ForkPoolWorker-1] üìã Configuration:
[2026-01-06 15:26:57,701: INFO/ForkPoolWorker-1]    Embedding field: clean_embedding
[2026-01-06 15:26:57,701: INFO/ForkPoolWorker-1]    UMAP components: 30D
[2026-01-06 15:26:57,701: INFO/ForkPoolWorker-1]    HDBSCAN min_cluster_size: 5
[2026-01-06 15:26:57,701: INFO/ForkPoolWorker-1]    HDBSCAN min_samples: 2
[2026-01-06 15:26:57,701: INFO/ForkPoolWorker-1] 
[2026-01-06 15:26:57,701: INFO/ForkPoolWorker-1] üìä Loading documents with clean_embedding...
[2026-01-06 15:26:58,011: INFO/ForkPoolWorker-1] ‚úÖ Loaded 968 documents
[2026-01-06 15:26:58,013: INFO/ForkPoolWorker-1] üìê Embeddings shape: (968, 768)
[2026-01-06 15:26:58,013: INFO/ForkPoolWorker-1] ‚öôÔ∏è Configuring BERTopic components...
[2026-01-06 15:26:58,014: INFO/ForkPoolWorker-1]    - UMAP 768D ‚Üí 30D
[2026-01-06 15:26:58,014: INFO/ForkPoolWorker-1]    - HDBSCAN (min_cluster=5, min_samples=2)
[2026-01-06 15:26:58,014: INFO/ForkPoolWorker-1]    - Vectorizer (ngrams=(1, 3), max_features=5000)
[2026-01-06 15:26:58,014: INFO/ForkPoolWorker-1] üì¶ Loading embedding model for representation...
[2026-01-06 15:26:58,054: INFO/ForkPoolWorker-1] Use pytorch device_name: cuda
[2026-01-06 15:26:58,054: INFO/ForkPoolWorker-1] Load pretrained SentenceTransformer: sentence-transformers/paraphrase-multilingual-mpnet-base-v2
[2026-01-06 15:27:07,161: INFO/ForkPoolWorker-1] üéØ Creating BERTopic model...
[2026-01-06 15:27:07,161: INFO/ForkPoolWorker-1] üîÑ Fitting BERTopic model...
[2026-01-06 15:27:07,169: WARNING/ForkPoolWorker-1] 2026-01-06 15:27:07,169 - BERTopic - Dimensionality - Fitting the dimensionality reduction algorithm
[2026-01-06 15:27:15,907: WARNING/ForkPoolWorker-1] 2026-01-06 15:27:15,907 - BERTopic - Dimensionality - Completed ‚úì
[2026-01-06 15:27:15,907: WARNING/ForkPoolWorker-1] 2026-01-06 15:27:15,907 - BERTopic - Cluster - Start clustering the reduced embeddings
[2026-01-06 15:27:16,019: WARNING/ForkPoolWorker-1] 2026-01-06 15:27:16,019 - BERTopic - Cluster - Completed ‚úì
[2026-01-06 15:27:16,021: WARNING/ForkPoolWorker-1] 2026-01-06 15:27:16,021 - BERTopic - Representation - Extracting topics from clusters using representation models.
[2026-01-06 15:27:23,868: WARNING/ForkPoolWorker-1] 2026-01-06 15:27:23,867 - BERTopic - Representation - Completed ‚úì
[2026-01-06 15:27:24,413: INFO/ForkPoolWorker-1] 
[2026-01-06 15:27:24,413: INFO/ForkPoolWorker-1] üìä Clustering Results:
[2026-01-06 15:27:24,413: INFO/ForkPoolWorker-1]    Topics found: 46
[2026-01-06 15:27:24,413: INFO/ForkPoolWorker-1]    Outliers: 78 (8.1%)
[2026-01-06 15:27:24,413: INFO/ForkPoolWorker-1] 
[2026-01-06 15:27:24,413: INFO/ForkPoolWorker-1] üìà Computing clustering quality metrics...
[2026-01-06 15:27:24,437: INFO/ForkPoolWorker-1]    Silhouette Score: 0.542
[2026-01-06 15:27:24,437: INFO/ForkPoolWorker-1]    Calinski-Harabasz: 3316.4
[2026-01-06 15:27:24,438: INFO/ForkPoolWorker-1]    Davies-Bouldin: 0.571
[2026-01-06 15:27:24,438: INFO/ForkPoolWorker-1] 
[2026-01-06 15:27:24,438: INFO/ForkPoolWorker-1] üîÑ Reducing to 2D for visualization...
[2026-01-06 15:27:24,438: INFO/ForkPoolWorker-1]    UMAP 2D params: n_neighbors=10, min_dist=0.99
[2026-01-06 15:27:26,691: INFO/ForkPoolWorker-1] ‚úÖ 2D embeddings shape: (968, 2)
[2026-01-06 15:27:26,691: INFO/ForkPoolWorker-1] üíæ Saving BERTopic model to database...
[2026-01-06 15:27:26,788: INFO/ForkPoolWorker-1] ‚úÖ Saved 47 topics and 968 document assignments
[2026-01-06 15:27:26,807: INFO/ForkPoolWorker-1] 
[2026-01-06 15:27:26,807: INFO/ForkPoolWorker-1] ================================================================================
[2026-01-06 15:27:26,807: INFO/ForkPoolWorker-1] ‚úÖ OPTIMIZED BERTopic computation completed!
[2026-01-06 15:27:26,807: INFO/ForkPoolWorker-1] ================================================================================
[2026-01-06 15:27:26,807: INFO/ForkPoolWorker-1] üìä Final Results:
[2026-01-06 15:27:26,807: INFO/ForkPoolWorker-1]    Model ID: 5
[2026-01-06 15:27:26,807: INFO/ForkPoolWorker-1]    Documents: 968
[2026-01-06 15:27:26,807: INFO/ForkPoolWorker-1]    Topics: 46
[2026-01-06 15:27:26,807: INFO/ForkPoolWorker-1]    Outliers: 78 (8.1%)
[2026-01-06 15:27:26,807: INFO/ForkPoolWorker-1]    Computation Time: 28.99s
[2026-01-06 15:27:26,807: INFO/ForkPoolWorker-1]    Silhouette Score: 0.542
[2026-01-06 15:27:26,807: INFO/ForkPoolWorker-1] ================================================================================
[2026-01-06 15:27:26,807: INFO/ForkPoolWorker-1] 
[2026-01-06 15:27:26,809: INFO/ForkPoolWorker-1] ‚úÖ Activating new BERTopic model 5...
[2026-01-06 15:27:26,813: INFO/ForkPoolWorker-1] ================================================================================
[2026-01-06 15:27:26,813: INFO/ForkPoolWorker-1] ‚úÖ BERTOPIC MODEL COMPUTATION COMPLETED
[2026-01-06 15:27:26,814: INFO/ForkPoolWorker-1] ================================================================================
[2026-01-06 15:27:26,814: INFO/ForkPoolWorker-1] Model ID: 5
[2026-01-06 15:27:26,814: INFO/ForkPoolWorker-1] Documents: 968
[2026-01-06 15:27:26,814: INFO/ForkPoolWorker-1] Topics: 46
[2026-01-06 15:27:26,814: INFO/ForkPoolWorker-1] Outliers: 78
[2026-01-06 15:27:26,814: INFO/ForkPoolWorker-1] Time: 28.99s
[2026-01-06 15:27:26,818: INFO/ForkPoolWorker-1] Task apps.documents.tasks.compute_bertopic_model[24142269-a1dc-4f2c-8527-47d88f6c69c5] succeeded in 33.510549995000474s: {'status': 'success', 'model_id': 5, 'document_count': 968, 'topic_count': 46, 'outlier_count': 78, 'computation_time': 28.990370273590088, 'created_at': '2026-01-06T15:27:26.691882+00:00'}

Restarting celery worker (/home/vicari/Downloads/PROJECTS/temp_/backend/venv/bin/celery -A config worker -Q default -l info -n worker_default@%h --concurrency=1)
[2026-01-06 15:45:15,390: CRITICAL/MainProcess] Unrecoverable error: RuntimeError("reentrant call inside <_io.BufferedWriter name='<stdout>'>")
Traceback (most recent call last):
  File "/home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/celery/worker/worker.py", line 202, in start
    self.blueprint.start(self)
  File "/home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/celery/bootsteps.py", line 116, in start
    step.start(parent)
  File "/home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/celery/bootsteps.py", line 365, in start
    return self.obj.start()
           ^^^^^^^^^^^^^^^^
  File "/home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/celery/worker/consumer/consumer.py", line 340, in start
    blueprint.start(self)
  File "/home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/celery/bootsteps.py", line 116, in start
    step.start(parent)
  File "/home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/celery/worker/consumer/consumer.py", line 746, in start
    c.loop(*c.loop_args())
  File "/home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/celery/worker/loops.py", line 97, in asynloop
    next(loop)
  File "/home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/kombu/asynchronous/hub.py", line 317, in create_loop
    events = poll(poll_timeout)
             ^^^^^^^^^^^^^^^^^^
  File "/home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/kombu/utils/eventio.py", line 83, in poll
    return self._epoll.poll(timeout if timeout is not None else -1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/celery/apps/worker.py", line 347, in restart_worker_sig_handler
    safe_say(f"Restarting celery worker ({' '.join(sys.argv)})",
  File "/home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/celery/apps/worker.py", line 81, in safe_say
    print(f'\n{msg}', file=f, flush=True)
  File "/home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/celery/apps/worker.py", line 347, in restart_worker_sig_handler
    safe_say(f"Restarting celery worker ({' '.join(sys.argv)})",
  File "/home/vicari/Downloads/PROJECTS/python-projects/poder-judicial-project/backup-pj-no-similarity/poder-judicial-docs/backend/venv/lib/python3.12/site-packages/celery/apps/worker.py", line 81, in safe_say
    print(f'\n{msg}', file=f, flush=True)
RuntimeError: reentrant call inside <_io.BufferedWriter name='<stdout>'>

worker: Warm shutdown (MainProcess)

Restarting celery worker (/home/vicari/Downloads/PROJECTS/temp_/backend/venv/bin/celery -A config worker -Q default -l info -n worker_default@%h --concurrency=1)
